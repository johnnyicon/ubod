# Agent Registry Format Specification

**Version:** 1.0  
**Last Updated:** 2026-01-22  
**Purpose:** Define the YAML structure for agent registries used in intelligent routing

---

## Overview

An **agent registry** is a machine-readable catalog that enables orchestrator agents to discover specialist agents and make intelligent routing decisions using semantic matching.

**Key Benefits:**
- **Discovery:** Orchestrators can programmatically find available agents
- **Routing:** Semantic matching based on domains and keywords
- **Maintenance:** Auto-generated from agent frontmatter (DRY principle)
- **Extensibility:** Add custom fields without changing agent files

**File Location:** `.github/agents/agents-registry.yaml`

**Generated By:** `/agent-registry-update` prompt (scans `.agent.md` files)

---

## YAML Structure

### Top-Level Schema

```yaml
# Agent Registry
# Auto-generated by /agent-registry-update prompt
# Last Updated: YYYY-MM-DD

version: "1.0"

agents:
  # Agent metadata (required)
  
categories:
  # Agent groupings (required)
  
routing:
  # Routing configuration (optional but recommended)
  
stats:
  # Summary statistics (optional)
```

---

## Section 1: Agents

**Purpose:** Catalog of all agents with routing metadata

**Structure:**

```yaml
agents:
  
  agent-id:
    file: agent-filename.agent.md
    name: Human-Readable Agent Name
    description: "Full description from agent frontmatter"
    domains: [domain1, domain2, ...]
    keywords: [keyword1, keyword2, ...]
    complexity: simple|multi-step|comprehensive
    tools: [read, search, edit, create_file, agent, execute]
```

### Field Definitions

#### `agent-id` (key)
- **Type:** String
- **Format:** Kebab-case (lowercase with hyphens)
- **Example:** `myapp-prd-enricher`, `myapp-implementer`
- **Purpose:** Unique identifier for referencing agent
- **Source:** Derived from filename (remove `.agent.md`)

#### `file` (required)
- **Type:** String
- **Format:** Filename with extension
- **Example:** `myapp-prd-enricher.agent.md`
- **Purpose:** Relative path to agent file (from `.github/agents/`)
- **Validation:** File must exist

#### `name` (required)
- **Type:** String
- **Format:** Title Case with spaces
- **Example:** `My App PRD Enricher`
- **Purpose:** Human-readable display name
- **Source:** Agent frontmatter `name` field

#### `description` (required)
- **Type:** String
- **Length:** 50-500 characters
- **Example:** `"Orchestrate multi-agent enrichment of base PRDs with app-specific context"`
- **Purpose:** Full description for semantic matching
- **Source:** Agent frontmatter `description` field
- **Usage:** Orchestrators parse this to infer intent

#### `domains` (required)
- **Type:** Array of strings
- **Length:** 1-5 domains
- **Format:** Lowercase, hyphenated
- **Examples:** `[prd, orchestration, design, architecture]`
- **Purpose:** Primary capability areas for semantic matching
- **Common Values:**
  - `prd` - Product requirements and feature design
  - `discovery` - Codebase exploration and pattern finding
  - `architecture` - System design and technical architecture
  - `ui` / `ux` - User interface and experience design
  - `design-system` - Component library and design tokens
  - `implementation` - Feature coding and development
  - `testing` - Test strategy and execution
  - `verification` - Quality assurance and validation
  - `documentation` - Technical writing and docs maintenance
  - `review` - Code review and quality checks
  - `security` - Security audits and vulnerability scanning
  - `performance` - Performance optimization and profiling
  - `deployment` - CI/CD and infrastructure
  - `monitoring` - Observability and alerting
- **Source:** Inferred from description or explicitly set

#### `keywords` (required)
- **Type:** Array of strings
- **Length:** 5-20 keywords
- **Format:** Lowercase, singular nouns or verbs
- **Example:** `[prd, enrich, orchestrate, multi-agent, tala, context, feature, requirements]`
- **Purpose:** Semantic routing via keyword matching
- **Extraction:** From description (nouns/verbs) + domain terms
- **Usage:** Orchestrators match user request keywords against these

#### `complexity` (required)
- **Type:** Enum string
- **Values:**
  - `simple` - Quick tasks, < 5 min (file reads, simple checks)
  - `multi-step` - Workflow with phases, 10-30 min (implementation, testing)
  - `comprehensive` - Deep analysis, 20+ min (architecture, planning)
- **Purpose:** Help orchestrators decide when to delegate
- **Inference:** Based on workflow length or explicit setting

#### `tools` (optional but recommended)
- **Type:** Array of strings
- **Values:** `[read, search, edit, create_file, execute, agent]`
- **Purpose:** Capabilities available to agent
- **Source:** Agent frontmatter `tools` field
- **Usage:** Verify agent can perform required actions

---

## Section 2: Categories

**Purpose:** Group agents by primary domain for browsing

**Structure:**

```yaml
categories:
  
  category-name:
    description: "What this category covers"
    agents:
      - agent-id-1
      - agent-id-2
```

### Field Definitions

#### `category-name` (key)
- **Type:** String
- **Format:** Kebab-case
- **Examples:** `planning`, `design`, `implementation`, `verification`, `documentation`
- **Purpose:** Logical grouping of related agents

#### `description` (optional)
- **Type:** String
- **Example:** `"Discovery, planning, and requirements"`
- **Purpose:** Explain what agents in this category do

#### `agents` (required)
- **Type:** Array of agent IDs
- **Validation:** Each ID must exist in `agents` section
- **Purpose:** List agents belonging to this category

### Common Categories

```yaml
categories:
  orchestration:
    description: "Intelligent routing and task coordination"
    agents: [app-orchestrator]
  
  planning:
    description: "Discovery, planning, and requirements"
    agents: [discovery-planner, prd-enricher]
  
  design:
    description: "UI/UX design and design system"
    agents: [ui-designer, design-system]
  
  implementation:
    description: "Feature development and coding"
    agents: [implementer, backend-dev, frontend-dev]
  
  verification:
    description: "Testing, verification, and quality assurance"
    agents: [verifier, tester, qa-engineer]
  
  documentation:
    description: "Documentation maintenance and review"
    agents: [docs-updater, docs-reviewer]
  
  security:
    description: "Security audits and vulnerability scanning"
    agents: [security-auditor, pentest-agent]
  
  performance:
    description: "Performance optimization and profiling"
    agents: [performance-optimizer, profiler]
```

---

## Section 3: Routing

**Purpose:** Configuration for orchestrators to make routing decisions

**Structure:**

```yaml
routing:
  default_behavior: semantic_match  # semantic_match | ask_if_ambiguous | show_menu
  fallback: handle_directly         # handle_directly | error | ask
  
  patterns:
    - keywords: [keyword1, keyword2, ...]
      suggest: agent-id
      confidence: high|medium|low
      note: "Optional explanation of pattern"
```

### Field Definitions

#### `default_behavior` (optional, default: `semantic_match`)
- **Type:** Enum string
- **Values:**
  - `semantic_match` - Match user keywords to agent domains/keywords
  - `ask_if_ambiguous` - Ask user when multiple matches
  - `show_menu` - Always show menu of options
- **Purpose:** How orchestrator decides which agent to invoke

#### `fallback` (optional, default: `handle_directly`)
- **Type:** Enum string
- **Values:**
  - `handle_directly` - Orchestrator handles if no match
  - `error` - Return error if no match
  - `ask` - Ask user what to do
- **Purpose:** What happens when no agent matches

#### `patterns` (optional but highly recommended)
- **Type:** Array of routing hints
- **Purpose:** Pre-defined keyword ‚Üí agent mappings

##### Pattern Fields

**`keywords`** (required)
- **Type:** Array of strings
- **Format:** Lowercase keywords
- **Example:** `[prd, feature, design, specification, requirements]`
- **Purpose:** Keywords that trigger this routing

**`suggest`** (required)
- **Type:** String (agent ID)
- **Example:** `myapp-prd-enricher`
- **Validation:** Must exist in `agents` section
- **Purpose:** Which agent to route to

**`confidence`** (required)
- **Type:** Enum string
- **Values:**
  - `high` - Strong signal, auto-route (90%+ keyword match)
  - `medium` - Partial signal, ask confirmation (60-89% match)
  - `low` - Weak signal, show as option (< 60% match)
- **Purpose:** How confident orchestrator should be

**`note`** (optional)
- **Type:** String
- **Example:** `"Feature design and PRD enrichment"`
- **Purpose:** Explain why this pattern exists (for maintainers)

### Routing Pattern Examples

```yaml
routing:
  default_behavior: semantic_match
  fallback: handle_directly
  
  patterns:
    # High confidence patterns (auto-route)
    - keywords: [prd, feature, design, specification, requirements, enrich]
      suggest: myapp-prd-enricher
      confidence: high
      note: "PRD enrichment and feature design"
    
    - keywords: [discover, find, search, patterns, examples, existing, analyze, map]
      suggest: myapp-discovery-planner
      confidence: high
      note: "Codebase discovery and pattern analysis"
    
    - keywords: [implement, build, code, create, develop, feature, backend, frontend]
      suggest: myapp-implementer
      confidence: high
      note: "Feature implementation"
    
    # Medium confidence patterns (ask first)
    - keywords: [document, docs, readme, guide, update-docs, documentation]
      suggest: myapp-docs-updater
      confidence: medium
      note: "Documentation updates"
    
    - keywords: [review-docs, broken-links, outdated, consistency]
      suggest: myapp-docs-reviewer
      confidence: medium
      note: "Documentation quality review"
    
    # Low confidence patterns (show as option)
    - keywords: [vision, product-vision, emergence, strategy, principles]
      suggest: myapp-vision-review
      confidence: low
      note: "Strategic vision alignment"
```

---

## Section 4: Stats

**Purpose:** Summary statistics about agent ecosystem

**Structure:**

```yaml
stats:
  total_agents: 10
  by_complexity:
    simple: 4
    multi-step: 5
    comprehensive: 1
  by_category:
    orchestration: 1
    planning: 2
    design: 2
    implementation: 1
    verification: 1
    documentation: 3
  last_updated: "2026-01-22"
  generated_by: "/agent-registry-update prompt"
```

### Field Definitions

#### `total_agents` (optional)
- **Type:** Integer
- **Example:** `10`
- **Purpose:** Count of agents in registry

#### `by_complexity` (optional)
- **Type:** Object with complexity counts
- **Fields:** `simple`, `multi-step`, `comprehensive`
- **Purpose:** Distribution of agent complexity

#### `by_category` (optional)
- **Type:** Object with category counts
- **Fields:** Category names ‚Üí count
- **Purpose:** How many agents per category

#### `last_updated` (optional)
- **Type:** String (ISO date)
- **Format:** `YYYY-MM-DD`
- **Purpose:** When registry was last regenerated

#### `generated_by` (optional)
- **Type:** String
- **Example:** `"/agent-registry-update prompt"`
- **Purpose:** What tool generated this registry

---

## Complete Example

```yaml
# Agent Registry
# Auto-generated by /agent-registry-update prompt
# Last Updated: 2026-01-22

version: "1.0"

# ======================================
# My App Agents
# ======================================

agents:
  
  myapp-orchestrator:
    file: myapp-orchestrator.agent.md
    name: My App Orchestrator
    description: "Intelligent dispatcher and executor - routes to specialists OR handles directly"
    domains: [orchestration, routing, general-purpose]
    keywords: [orchestrate, route, dispatch, handle, discovery, general, any, help]
    complexity: multi-step
    tools: [agent, read, search, edit, create_file, execute]
  
  myapp-prd-enricher:
    file: myapp-prd-enricher.agent.md
    name: My App PRD Enricher
    description: "Orchestrate multi-agent enrichment of base PRDs with app-specific context"
    domains: [prd, orchestration, design, architecture]
    keywords: [prd, enrich, orchestrate, multi-agent, context, feature, requirements]
    complexity: multi-step
    tools: [agent, read, search]
  
  myapp-discovery-planner:
    file: myapp-discovery-planner.agent.md
    name: My App Discovery Planner
    description: "Evidence-first discovery and implementation planning. Reads code, maps patterns."
    domains: [discovery, planning, analysis]
    keywords: [discovery, evidence, code, map, patterns, plan, implementation, analyze]
    complexity: comprehensive
    tools: [read, search]
  
  myapp-implementer:
    file: myapp-implementer.agent.md
    name: My App Implementer
    description: "Implements features end-to-end (backend + UI). Makes small diffs, runs tests."
    domains: [implementation, development, coding]
    keywords: [implement, code, build, develop, backend, ui, tests, iterate, feature]
    complexity: multi-step
    tools: [read, search, edit, create_file, execute]
  
  myapp-verifier:
    file: myapp-verifier.agent.md
    name: My App Verifier
    description: "Verifies correctness beyond tests. Runs tests, checks runtime behavior."
    domains: [verification, testing, qa]
    keywords: [verify, validate, test, qa, correctness, runtime, behavior, edge-cases]
    complexity: multi-step
    tools: [read, search, execute]
  
  myapp-docs-updater:
    file: myapp-docs-updater.agent.md
    name: My App Docs Updater
    description: "Update documentation after implementation changes"
    domains: [documentation, maintenance]
    keywords: [docs, documentation, update, prd, analyze, workflow, maintain]
    complexity: simple
    tools: [read, search, edit, agent]

# ======================================
# Agent Categories
# ======================================

categories:
  orchestration:
    description: "Intelligent routing and task coordination"
    agents:
      - myapp-orchestrator
  
  planning:
    description: "Discovery, planning, and requirements"
    agents:
      - myapp-discovery-planner
      - myapp-prd-enricher
  
  implementation:
    description: "Feature development and coding"
    agents:
      - myapp-implementer
  
  verification:
    description: "Testing, verification, and quality assurance"
    agents:
      - myapp-verifier
  
  documentation:
    description: "Documentation maintenance and review"
    agents:
      - myapp-docs-updater

# ======================================
# Routing Configuration
# ======================================

routing:
  default_behavior: semantic_match
  fallback: handle_directly
  
  patterns:
    - keywords: [help, general, any, orchestrate, route, dispatch]
      suggest: myapp-orchestrator
      confidence: high
      note: "Default entry point"
    
    - keywords: [prd, feature, design, specification, requirements, enrich]
      suggest: myapp-prd-enricher
      confidence: high
      note: "PRD enrichment"
    
    - keywords: [discover, find, search, patterns, examples, existing, analyze, map]
      suggest: myapp-discovery-planner
      confidence: high
      note: "Codebase discovery"
    
    - keywords: [implement, build, code, create, develop, feature, backend]
      suggest: myapp-implementer
      confidence: high
      note: "Feature implementation"
    
    - keywords: [test, verify, validate, check, qa, correctness, behavior]
      suggest: myapp-verifier
      confidence: high
      note: "Testing and verification"
    
    - keywords: [document, docs, readme, guide, update-docs, documentation]
      suggest: myapp-docs-updater
      confidence: medium
      note: "Documentation updates"

# ======================================
# Statistics
# ======================================

stats:
  total_agents: 6
  by_complexity:
    simple: 1
    multi-step: 4
    comprehensive: 1
  by_category:
    orchestration: 1
    planning: 2
    implementation: 1
    verification: 1
    documentation: 1
  last_updated: "2026-01-22"
  generated_by: "/agent-registry-update prompt"
```

---

## Usage in Orchestrators

### Loading Registry

```markdown
## WORKFLOW Phase 1: Load Agent Registry

üìÇ Loading agent registry...
read_file(".github/agents/agents-registry.yaml")

Registry loaded: {{N}} specialists available
- Orchestration: {{list}}
- Planning: {{list}}
- Implementation: {{list}}
- Verification: {{list}}
- Documentation: {{list}}
```

### Semantic Matching Algorithm

```typescript
function findBestAgent(userRequest: string, registry: AgentRegistry): RoutingDecision {
  // Extract keywords from user request
  const userKeywords = extractKeywords(userRequest).map(k => k.toLowerCase());
  
  // Calculate match scores for each routing pattern
  const matches = registry.routing.patterns.map(pattern => {
    const matchedKeywords = pattern.keywords.filter(k => 
      userKeywords.includes(k) || userKeywords.some(uk => uk.includes(k))
    );
    
    const matchScore = matchedKeywords.length / pattern.keywords.length;
    
    return {
      agent: pattern.suggest,
      confidence: pattern.confidence,
      score: matchScore,
      matchedKeywords
    };
  });
  
  // Sort by score descending
  matches.sort((a, b) => b.score - a.score);
  
  const best = matches[0];
  
  // Apply confidence thresholds
  if (best.score >= 0.90 && best.confidence === 'high') {
    return { agent: best.agent, action: 'auto-route', confidence: 'high' };
  } else if (best.score >= 0.60 && best.confidence !== 'low') {
    return { agent: best.agent, action: 'ask-confirmation', confidence: 'medium' };
  } else if (best.score >= 0.40) {
    return { agent: best.agent, action: 'show-option', confidence: 'low' };
  } else {
    return { action: 'handle-directly', confidence: 'none' };
  }
}
```

### Routing Decision Tree

```
User Request ‚Üí Extract Keywords
                    ‚Üì
            Match Against Patterns
                    ‚Üì
         Calculate Match Scores
                    ‚Üì
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ                     ‚îÇ
    Score ‚â• 90%           60% ‚â§ Score < 90%
    Confidence: high      Confidence: medium
         ‚îÇ                     ‚îÇ
    Auto-Route            Ask Confirmation
         ‚Üì                     ‚Üì
    Invoke Agent         "Route to X?"
                              ‚Üì
                         User: Yes/No
                              ‚Üì
                    Yes ‚Üí Invoke Agent
                    No ‚Üí Show Options
```

---

## Validation Rules

**Registry is valid if:**

1. ‚úÖ **YAML Syntax:** Parses without errors
2. ‚úÖ **Version:** `version: "1.0"` present
3. ‚úÖ **Agents Section:** At least one agent defined
4. ‚úÖ **Required Fields:** Each agent has `file`, `name`, `description`, `domains`, `keywords`
5. ‚úÖ **File Existence:** All `file` paths exist in `.github/agents/`
6. ‚úÖ **No Duplicates:** Agent IDs are unique
7. ‚úÖ **Category References:** All agents in categories exist in `agents` section
8. ‚úÖ **Routing References:** All `suggest` values exist in `agents` section
9. ‚úÖ **Enum Values:** `complexity`, `confidence`, `default_behavior`, `fallback` use valid values

**Validation Script:**

```bash
# Run validation (if ubod provides this)
ubod validate-registry .github/agents/agents-registry.yaml
```

---

## Extensibility

**Custom Fields (Not Breaking):**

Add app-specific fields without breaking ubod compatibility:

```yaml
agents:
  myapp-agent:
    # Standard fields
    file: myapp-agent.agent.md
    name: My App Agent
    description: "..."
    domains: [...]
    keywords: [...]
    complexity: simple
    tools: [...]
    
    # Custom fields
    typical_duration_minutes: 15
    requires: ["database", "api-key"]
    output_format: "markdown"
    interactive: true
    priority: 1
```

**Custom Routing Logic:**

```yaml
routing:
  default_behavior: semantic_match
  fallback: handle_directly
  
  # Custom routing configuration
  confidence_thresholds:
    high: 0.90
    medium: 0.60
    low: 0.40
  
  max_suggestions: 3
  show_confidence_scores: true
```

---

## Maintenance

**When to regenerate:**
- After creating new agents
- After updating agent descriptions
- After removing agents
- When routing patterns aren't working (keyword updates)

**How to regenerate:**
```
/agent-registry-update refresh
```

**Version History:**
- v1.0 (2026-01-22): Initial schema

---

## See Also

- **Generation Prompt:** `templates/prompts/agent-registry-update.prompt.md`
- **Agent Schema:** `ubod-meta/schemas/agent-schema.md`
- **Orchestration Guide:** `ubod-meta/docs/multi-agent-orchestration-guide.md`
- **Case Study:** `ubod-meta/docs/case-studies/tala-orchestrator.md`
